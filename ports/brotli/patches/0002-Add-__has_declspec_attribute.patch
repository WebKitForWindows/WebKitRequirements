From aea616e1a344c9b79024b4c8aa733c643663418f Mon Sep 17 00:00:00 2001
From: Don <don.j.olmstead@gmail.com>
Date: Mon, 24 Sep 2018 18:22:19 -0700
Subject: [PATCH 2/2] Add __has_declspec_attribute

Clang contains __has_declspec_attribute for MSVC compatibility. This can be
used to determine whether __declspec is available.
---
 c/include/brotli/port.h | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/c/include/brotli/port.h b/c/include/brotli/port.h
index 825237a..e4e3e39 100644
--- a/c/include/brotli/port.h
+++ b/c/include/brotli/port.h
@@ -257,8 +257,12 @@
 
 /* <<< <<< <<< end of hedley macros. */
 
+#ifndef __has_declspec_attribute
+#define __has_declspec_attribute(x) 0
+#endif
+
 #if defined(BROTLI_SHARED_COMPILATION)
-#if defined(_WIN32)
+#if defined(_WIN32) || (__has_declspec_attribute(dllexport) && __has_declspec_attribute(dllimport))
 #if defined(BROTLICOMMON_SHARED_COMPILATION)
 #define BROTLI_COMMON_API __declspec(dllexport)
 #else
-- 
2.26.2.windows.1

