From eed28837e3db3e54159ec2d91082d788108db5c3 Mon Sep 17 00:00:00 2001
From: Don <don.j.olmstead@gmail.com>
Date: Tue, 10 Jan 2023 15:19:42 -0800
Subject: [PATCH 3/3] Make hard-coded static library suffix optional

Add `STATIC_LIB_SUFFIX` to set the suffix directly.
---
 crypto/boringssl/CMakeLists.txt | 1 +
 crypto/gnutls/CMakeLists.txt    | 1 +
 crypto/openssl/CMakeLists.txt   | 1 +
 crypto/picotls/CMakeLists.txt   | 1 +
 crypto/wolfssl/CMakeLists.txt   | 1 +
 lib/CMakeLists.txt              | 1 +
 6 files changed, 6 insertions(+)

diff --git a/crypto/boringssl/CMakeLists.txt b/crypto/boringssl/CMakeLists.txt
index 004fb6a9..2906a506 100644
--- a/crypto/boringssl/CMakeLists.txt
+++ b/crypto/boringssl/CMakeLists.txt
@@ -68,6 +68,7 @@ if(ENABLE_STATIC_LIB)
   add_library(ngtcp2_crypto_boringssl_static ${ngtcp2_crypto_boringssl_SOURCES})
   set_target_properties(ngtcp2_crypto_boringssl_static PROPERTIES
     COMPILE_FLAGS "${WARNCFLAGS}"
+    ARCHIVE_OUTPUT_NAME ngtcp2_crypto_boringssl${STATIC_LIB_SUFFIX}
     C_VISIBILITY_PRESET hidden
   )
   target_compile_definitions(ngtcp2_crypto_boringssl_static PUBLIC
diff --git a/crypto/gnutls/CMakeLists.txt b/crypto/gnutls/CMakeLists.txt
index 9b7f2253..e765fd58 100644
--- a/crypto/gnutls/CMakeLists.txt
+++ b/crypto/gnutls/CMakeLists.txt
@@ -70,6 +70,7 @@ if(ENABLE_STATIC_LIB)
     COMPILE_FLAGS "${WARNCFLAGS}"
     VERSION ${CRYPTO_GNUTLS_LT_VERSION}
     SOVERSION ${CRYPTO_GNUTLS_LT_SOVERSION}
+    ARCHIVE_OUTPUT_NAME ngtcp2_crypto_gnutls${STATIC_LIB_SUFFIX}
     C_VISIBILITY_PRESET hidden
   )
   target_compile_definitions(ngtcp2_crypto_gnutls_static PUBLIC
diff --git a/crypto/openssl/CMakeLists.txt b/crypto/openssl/CMakeLists.txt
index d9a126c4..8cb23dea 100644
--- a/crypto/openssl/CMakeLists.txt
+++ b/crypto/openssl/CMakeLists.txt
@@ -70,6 +70,7 @@ if(ENABLE_STATIC_LIB)
     COMPILE_FLAGS "${WARNCFLAGS}"
     VERSION ${CRYPTO_OPENSSL_LT_VERSION}
     SOVERSION ${CRYPTO_OPENSSL_LT_SOVERSION}
+    ARCHIVE_OUTPUT_NAME ngtcp2_crypto_openssl${STATIC_LIB_SUFFIX}
     C_VISIBILITY_PRESET hidden
   )
   target_compile_definitions(ngtcp2_crypto_openssl_static PUBLIC
diff --git a/crypto/picotls/CMakeLists.txt b/crypto/picotls/CMakeLists.txt
index 4bfdedec..0a73c6e4 100644
--- a/crypto/picotls/CMakeLists.txt
+++ b/crypto/picotls/CMakeLists.txt
@@ -49,6 +49,7 @@ if(ENABLE_STATIC_LIB)
   add_library(ngtcp2_crypto_picotls_static ${ngtcp2_crypto_picotls_SOURCES})
   set_target_properties(ngtcp2_crypto_picotls_static PROPERTIES
     COMPILE_FLAGS "${WARNCFLAGS}"
+    ARCHIVE_OUTPUT_NAME ngtcp2_crypto_picotls${STATIC_LIB_SUFFIX}
     C_VISIBILITY_PRESET hidden
   )
   target_compile_definitions(ngtcp2_crypto_picotls_static PUBLIC
diff --git a/crypto/wolfssl/CMakeLists.txt b/crypto/wolfssl/CMakeLists.txt
index 8cea3e5d..9dcde865 100644
--- a/crypto/wolfssl/CMakeLists.txt
+++ b/crypto/wolfssl/CMakeLists.txt
@@ -68,6 +68,7 @@ if(ENABLE_STATIC_LIB)
   add_library(ngtcp2_crypto_wolfssl_static ${ngtcp2_crypto_wolfssl_SOURCES})
   set_target_properties(ngtcp2_crypto_wolfssl_static PROPERTIES
     COMPILE_FLAGS "${WARNCFLAGS}"
+    ARCHIVE_OUTPUT_NAME ngtcp2_crypto_wolfssl${STATIC_LIB_SUFFIX}
     C_VISIBILITY_PRESET hidden
   )
   target_compile_definitions(ngtcp2_crypto_wolfssl_static PUBLIC
diff --git a/lib/CMakeLists.txt b/lib/CMakeLists.txt
index c8195842..886d12a5 100644
--- a/lib/CMakeLists.txt
+++ b/lib/CMakeLists.txt
@@ -95,6 +95,7 @@ if(HAVE_CUNIT OR ENABLE_STATIC_LIB)
   set_target_properties(ngtcp2_static PROPERTIES
     COMPILE_FLAGS "${WARNCFLAGS}"
     VERSION ${LT_VERSION} SOVERSION ${LT_SOVERSION}
+    ARCHIVE_OUTPUT_NAME ngtcp2${STATIC_LIB_SUFFIX}
     C_VISIBILITY_PRESET hidden
   )
   target_compile_definitions(ngtcp2_static PUBLIC "-DNGTCP2_STATICLIB")
-- 
2.39.0.windows.2

